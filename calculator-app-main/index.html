<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  
  <title>Frontend Mentor | Calculator app</title>

  <!-- Feel free to remove these styles or customise in your own stylesheet 👍 -->
  <style>
    .attribution { font-size: 11px; text-align: center; }
    .attribution a { color: hsl(228, 45%, 44%); }
  </style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Spartan:wght@700&display=swap" rel="stylesheet">
</head>
<body>

<div class="calculatrice">
  <div class="haut">
    <h1 id="calc">calc</h1>
    <div class="themetxt"> 
      <p>THEME</p>
      <div class="range-bg"><input type="range" id="theme" min="0" max="2" step="1" value="0" oninput="themechange()"></div>
    </div>
  </div>
  
  <!-- La femme de Devie est complotiste -->
  
  <div class="result">
    <h1 class="r-value">399,981</h1>
  </div>
  
  <div class="grid-key">
    <button class="key">7</button><button class="key">8</button><button class="key">9</button><button class="key del">DEL</button>
    <button class="key">4</button><button class="key">5</button><button class="key">6</button><button class="key">+</button>
    <button class="key">1</button><button class="key">2</button><button class="key">3</button><button class="key">-</button>
    <button class="key">.</button><button class="key">0</button><button class="key">/</button><button class="key">x</button>
    <button class="key">(</button><button class="key">)</button><button class="key">x²</button><button class="key">x³</button>
    <button class="grid-span-2 key del">RESET</button><button class="grid-span-2 key equal">=</button>
  </div>
</div>
  <!-- <div class="attribution">
    Challenge by <a href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>. 
    Coded by <a href="#">Your Name Here</a>.
  </div> -->
  
  <script>

    function claculate(str) {
      if (str == "") {return "0"}

      let calc = ""
      calc = str.replaceAll("x", "*")
      calc = calc.replaceAll(",", ".")
      
      // Remove the last character if it is a sign (2+3+ -> 2+3)
      if (["*", "+", "-", "/"].includes(calc.slice(-1))) {
        calc = calc.substring(0, calc.length-1)
      };


      // Prevent numbers like "0011" to be considered as a binary number (0011 = 9)
      const numbers = calc.split(/[.\*+-/_()]/)
      const signs = calc.split(/[1234567890]/).join('').split('')
      let counter = 0
      let finalString = ""
      if (calc.substring(0, 1) === "(") {
        console.log("Trouvé !")
        finalString += "("
        signs.pop(0)
      }
      numbers.map(e => {

        if (counter < numbers.length -1) {
          finalString += Number(numbers[counter])+ signs[counter]
          counter += 1
        } else {
          finalString += Number(numbers[counter])
        }
      })
      
      console.log(finalString);

      let result = eval(finalString)
      result = Math.floor(result * 10000) / 10000
      result = String(result)
      result = result.replace(".", ",")
      return String(result).includes("Infinity") ? "Error" : String(result)
    }

    function sign(str) {
      if (!(["x", "*", "+", "-", "/"].includes(document.querySelector(".r-value").innerText.slice(-1)))) {
        document.querySelector(".r-value").innerText += str
      } else {
        let itext = String(document.querySelector(".r-value").innerText)
        document.querySelector(".r-value").innerText = document.querySelector(".r-value").innerText.substring(0, itext.length-1)
        document.querySelector(".r-value").innerText += str
      }
    
    }   
    document.querySelectorAll("button").forEach((elt)=>{
        elt.addEventListener("click", (e)=>{
          document.querySelector(".r-value").innerText == "Error" ? document.querySelector(".r-value").innerText = "" : document.querySelector(".r-value").innerText

          if (["1", "2", "3", "4", "5", "6", "7", "8", "9", "0"].includes(e.target.innerText)) {
            document.querySelector(".r-value").innerText += e.target.innerText
          
          } else if (e.target.innerText == ".") {
              document.querySelector(".r-value").innerText += ","
          
          } else if (e.target.innerText.localeCompare("DEL")==0) {
              let str = String(document.querySelector(".r-value").innerText)
              document.querySelector(".r-value").innerText = document.querySelector(".r-value").innerText.substring(0, str.length-1)
          
            } else if (e.target.innerText.localeCompare("RESET")==0) {
              document.querySelector(".r-value").innerText = ""
            
          } else if (e.target.innerText.localeCompare("=")==0) {
              document.querySelector(".r-value").innerText = claculate(document.querySelector(".r-value").innerText)
          } else  if (e.target.innerText.localeCompare("Binary")==0) {
            document.querySelector(".r-value").innerText = claculate(document.querySelector(".r-value").innerText)
          } else {
            sign(e.target.innerText)
          }
                      
        })
    })
    
    document.onkeydown = (e) => {
      document.querySelector(".r-value").innerText == "Error" ? document.querySelector(".r-value").innerText = "" : document.querySelector(".r-value").innerText

      if (["1", "2", "3", "4", "5", "6", "7", "8", "9"].includes(e.key)) {
        document.querySelector(".r-value").innerText += e.key
      } else if (e.key === "0") {
        document.querySelector(".r-value").innerText += e.key
      }

      else if (e.key == "Backspace") {
        let str = String(document.querySelector(".r-value").innerText)
        document.querySelector(".r-value").innerText = document.querySelector(".r-value").innerText.substring(0, str.length-1)
          
      } else if (e.key == "Enter") {
        document.querySelector(".r-value").innerText = claculate(document.querySelector(".r-value").innerText)
      
      } else if (["+", "-", "x", "/"].includes(e.key)) {
        sign(e.key)
      } else if (e.key == ".") {
        document.querySelector(".r-value").innerText += ","
        
      } else if (e.key == "*") {
        sign("x")
      }
    }

    function themechange() {
      let theme = document.getElementById("theme").value
      let root = document.documentElement.style

      if (theme == 0) {
    root.setProperty("--bg-main", "hsl(222, 26%, 31%)")
    root.setProperty("--bg-keypad", "hsl(223, 31%, 20%)")
    root.setProperty("--bg-screen", "hsl(224, 36%, 15%)")

    root.setProperty("--normal-bg", "hsl(30, 25%, 89%)")
    root.setProperty("--normal-shadow", "hsl(28, 16%, 65%)")
    root.setProperty("--del-bg", "hsl(225, 21%, 49%)")
    root.setProperty("--del-shadow", "hsl(224, 28%, 35%)")
    root.setProperty("--equal-bg", "hsl(6, 63%, 50%)")
    root.setProperty("--equal-shadow", "hsl(6, 70%, 34%)")
    
    root.setProperty("--color-calc", "white")
    root.setProperty("--color-del", "white")
    root.setProperty("--color-equal", "white")
    root.setProperty("--color-key", "hsl(221, 14%, 31%)")
    root.setProperty("--color-result", "white")
    
  } if (theme == 1) {
    
    root.setProperty("--bg-main",  "hsl(0, 0%, 90%)")
    root.setProperty("--bg-keypad", "hsl(0, 5%, 81%)")
    root.setProperty("--bg-screen", "hsl(0, 0%, 93%)")

    root.setProperty("--normal-bg", "hsl(45, 7%, 89%)")
    root.setProperty("--normal-shadow", "hsl(35, 11%, 61%)")
    root.setProperty("--del-bg", "hsl(185, 42%, 37%)")
    root.setProperty("--del-shadow", "hsl(185, 58%, 25%)")
    root.setProperty("--equal-bg", "hsl(25, 98%, 40%)")
    root.setProperty("--equal-shadow", "hsl(25, 99%, 27%)")
    
    root.setProperty("--color-calc", "")
    root.setProperty("--color-del", "")
    root.setProperty("--color-equal", "")
    root.setProperty("--color-key", "")
    
    root.setProperty("--color-calc", "hsl(60, 10%, 19%)")
    root.setProperty("--color-del", "white")
    root.setProperty("--color-equal", "white")
    root.setProperty("--color-key", "hsl(60, 10%, 19%)")
    root.setProperty("--color-result", "hsl(60, 10%, 19%)")
    
  } else if (theme == 2) {
    root.setProperty("--bg-main",  "hsl(268, 75%, 9%)")
    root.setProperty("--bg-keypad", "hsl(268, 71%, 12%)")
    root.setProperty("--bg-screen", "hsl(268, 71%, 12%)")

    root.setProperty("--normal-bg", "hsl(281, 89%, 26%)")
    root.setProperty("--normal-shadow", "hsl(285, 91%, 52%)")
    root.setProperty("--del-bg", "hsl(268, 47%, 21%)")
    root.setProperty("--del-shadow", "hsl(290, 70%, 36%)")
    root.setProperty("--equal-bg", "hsl(176, 100%, 44%)")
    root.setProperty("--equal-shadow", "hsl(177, 92%, 70%)")
    
    root.setProperty("--color-calc", "")
    root.setProperty("--color-del", "")
    root.setProperty("--color-equal", "")
    root.setProperty("--color-key", "")
    
    root.setProperty("--color-calc", "hsl(52, 100%, 62%)")
    root.setProperty("--color-del", "white")
    root.setProperty("--color-equal", "hsl(198, 20%, 13%)")
    root.setProperty("--color-key", "hsl(52, 100%, 62%)")
    root.setProperty("--color-result", "hsl(52, 100%, 62%)")

  }}

  </script>

</body>
</html>